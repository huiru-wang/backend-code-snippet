<!DOCTYPE html>
<html>
<head>
    <title>WebSocket 聊天示例</title>
</head>
<body>
<div id="messageArea" style="height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;"></div>
<input type="text" id="messageInput" placeholder="输入消息..." style="width: 70%; padding: 5px;">
<button onclick="sendMessage()" style="width: 25%; padding: 5px;">发送</button>

<!-- 引入SockJS和Stomp -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.0/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@6.1.2/dist/bundles/stomp.umd.min.js"></script>

<script>
    let stompClient = null;
    const messageArea = document.getElementById('messageArea');
    const messageInput = document.getElementById('messageInput');

    // 连接WebSocket
    function connect() {
        const socket = new SockJS('/chat-websocket');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, (frame) => {
            console.log('连接成功: ' + frame);

            // 订阅消息通道
            stompClient.subscribe('/topic/messages', (response) => {
                showMessage(JSON.parse(response.body));
            });
        });
    }

    // 显示消息
    function showMessage(message) {
        const p = document.createElement('p');
        p.textContent = message;
        messageArea.appendChild(p);
        messageArea.scrollTop = messageArea.scrollHeight;
    }

    // 发送消息
    function sendMessage() {
        const message = messageInput.value.trim();
        if (message && stompClient) {
            stompClient.send("/app/message", {}, JSON.stringify(message));
            messageInput.value = '';
        }
    }

    // 初始化连接
    connect();
</script>
</body>
</html>